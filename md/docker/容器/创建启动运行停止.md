## 创建、启动、执行命令、停止
* 基本操作
    * 创建容器`docker create [OPTION] IMAGE_NAME[:TAG] [COMMAND] [COMMAND_PARAMS]`
        * 参数
            * `OPTION`:操作参数
                * `-it`:为具有交互能力的`COMMAND`开启一个交互式终端前台进程。如果`COMMAND`不具有交互能力,则此参数无效。此参数必须是`OPTION`参数中的最后一个 
                * `-d`:执行`COMMAND`后保持容器在后台运行(即使有交互式终端)
                * `-v HOST_DIR:CONTAINER_DIR`:挂载目录
                    * `HOST_DIR`:宿主机目录 
                    * `CONTAINER_DIR`:容器目录 
                * `-p HOST_SYSTEM_PORT:CONTAINER_PORT[/PROTOCOL]`:端口映射
                    * `HOST_SYSTEM_PORT`:宿主机端口,可以为以下形式
                        * `HOST:PORT`,把宿主机的指定IP指定端口映射到容器中
                        * `HOST`,把宿主机的所有端口映射到容器中 
                        * `PROTOCOL`:协议。默认为`tcp`,亦可指定为`udp`
                    * `CONTAINER_PORT`:容器端口,例如`80`
                    * 示例
                        * `-p8888:80`,把宿主机的8888端口映射到容器的80端口
                        * `-p127.0.0.1:4000`,把宿主机的`127.0.0.1`上的所有端口映射到容器的4000端口 
                        * `-p127.0.0.1:80:80`,把宿主机的`127.0.0.1`上的80端口映射到容器的80端口 
                * `-P`:将`EXPOSE`端口随机映射到宿主机上的某个端口上。需要在使用`Dockerfile`构建镜像时使用`EXPOSE`指令
                * `--restart=RESTART_POLICY`:重启策略
                    * `RESTART_POLICY`为text,可取以下值:
                        * `no`:默认值。不自动启动 
                        * `on-failure[:NUMBER]`:若容器上次为非正常退出则重启容器。`NUMBER`为重试次数,默认为1
                        * `always`:容器总是在docker服务启动后自动启动 
                    * 修改容器的启动策略:`docker update OPTIONS CONTAINER_ID`
                        * `OPTIONS`:要更改的参数
                            * `--restart=RESTART_POLICY`
                        * `CONTAINER_ID`:容器ID 
                * `--name=NAME`:指定容器名称 
                    * NAME:容器名称
                    * 修改容器名称:`docker rename CONTAINER_ID NEW_NAME`
                        * `NEW_NAME`:容器的新名称
                        * `CONTAINER_ID`:容器ID 
                * `--hostname=NAME`:指定容器内的主机名称 
                * `--user=NAME`:指定进入容器时的默认用户名称(用户在镜像中必须存在) 
                * `--net=NETNAME`:指定子网名称(事先必须创建子网),同一个子网的容器可以把容器名称作为域名以互相通讯。
                * `--shm-size=SIZE`:指定容器的`/dev/shm`目录的大小。`SIZE`表示大小,单位可以为`g`或`m`,如`--shm-size=2g`
                * `--privileged=BOOL`是否开启运行用户应该具有的最大权限(当ssh无法连接时可能是因为docker启动的第一个进程的权限不足,开启此选项即可)
                    * BOOL
                        * true:开启 
                        * false:关闭 
                * `--gpus=GPU_DES`:指定使用的GPU数量或指定使用某个GPU 
                    1. 安装`nvidia-container-toolkit`
                        * ubuntu(定计算机已经安装显卡,安装`nvidia-container-toolkit`,如果已经安装则忽略)
                            1. 获取当前系统版本`distribution=$(. /etc/os-release;echo $ID$VERSION_ID)`
                            1. 获取nvidia-gpgkey并添加到apt中`curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add`
                            1. 将`nvidia-container-toolkit`源显示在屏幕上并写入`/etc/apt/sources.list.d/nvidia-docker.list`:`curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list`
                            1. 更新并安装`nvidia-container-toolkit`:`sudo apt-get update && sudo apt-get install -y nvidia-container-toolkit`
                            1. 重启docker服务
                    1. `GPU_DES`表示使用的GPU描述信息,它可取以下值
                        * all:表示使用所有的GPU
                        * 2:表示使用两个GPU
                        * '"device=1,3"':表示使用第一个GPU和第三个GPU 
                * `env ENV_NAME=ENV_VALUE`:设置环境变量 
            * `IMAGE_NAME[:TAG]`:`IMAGE_NAME`表示镜像名称,`TAG`表示镜像标签。省略`:TAG`时使用`latest`作为标签
            * `COMMAND`:当容器启动时要在容器中执行的命令(此命令为主线程,当主线程的前台进程结束后容器停止运行)。省略此参数则使用容器内默认的终端作为执行命令 
            * `COMMAND_PARAMS`:`COMMAND`命令的参数,每个参数可用空格隔开,且每个参数都应使用双引号包裹 
        * 已创建的容器:`docker ps [OPTION]`,其中`OPTION`可取以下值:
            * 无`OPTION`参数:显示正在运行的容器
            * `--no-trunc`:显示容器完整参数，不进行截断
            * `-a`:显示所有容器
            * `-s`:显示容器占用的硬盘大小 
            * `-N`:列出最近创建的`N`个容器 
            * `-f`:过滤条件
                * `id=CONTAINER_ID`:筛选容器id,`CONTAINER_ID`表示容器ID 
            * `--format`:自定义格式,如`"{{.ID}}\t{{.Names}}"`表示只显示容器ID和名称,每个字段应为`{{.FIELDS}}`形式,其中`FIELDS`表示字段名称,可定义以下字段:
                * `ID`:容器ID
                * `Names`:容器名称
                * `Image`:镜像名称和标签 
                * `Command`:容器启动的主进程
                * `CreatedAt`:容器创建时间
                * `RunningFor`:容器创建时距离现在的时长 
                * `Ports`:容器暴露的端口
                * `Status`:容器当前的状态
                * `Size`:容器占用磁盘的大小
                * `Labels`:容器标签
                * `Mounts`:容器挂载的目录(创建容器时`-v`参数所指定的挂载目录) 
                * `Networks`:容器加入的网桥 
        * 示例 
            * `docker create busybox`。创建一个镜像名称为`busybox:latest`的容器
            * `docker create --name=mybusy busybox`。创建一个镜像名称为`busybox:latest`的容器,并命名为`mybusy`
            * `docker create busybox cal`。创建一个镜像名称为`busybox:latest`的容器并且容器启动时默认执行`cal`命令 
            * `docker create -it ubuntu /bin/bash`。创建一个镜像名称为`ubuntu:latest`的容器并且容器启动时默认打开并保持交互式终端
    * 启动容器(不进入容器)
        * 启动`docker start CONTAINER_ID`,其中`CONTAINER_ID`表示容器ID或容器名称,多个容器ID或名称用空格分隔
        * 重启:`docker restart CONTAINER_ID`
        * 已启动的容器:`docker ps`
    * 进入容器:`docker attach CONTAINER_ID`(实际是进入容器的主线程交互界面) 
    * 容器执行命令:`docker exec [OPTION] CONTAINER_ID COMMAND [COMMAND_PARAMS]`
        * 参数
            * `OPTION`
                * `-it`:同`创建镜像`
                * `--user`:同`创建镜像`
            * `CONTAINER_ID`:容器ID 
            * `COMMAND`:要执行的命令 
            * `COMMAND_PARAMS`:`COMMAND`命令的参数,每个参数可用空格隔开,且每个参数都应使用双引号包裹 
        * 示例  
            * `docker exec 0ffb9635db7f date`:在已经启动的容器中执行`date`命令 
            * `docker exec -it 0ffb9635db7f /bin/bash`:在已经启动的容器中执行`/bin/bash`命令,并保持交互式终端开启状态
    * 停止容器
        * 安全停止:`docker stop CONTAINER_ID`
        * 强制停止:`docker kill CONTAINER_ID`
* 组合操作 
    * 创建、运行、执行:`docker run [OPTION] IMAGE_NAME[:TAG] [COMMAND] [COMMAND_PARAMS]`
        * 参数:同`创建容器`
        * 示例 
            * `docker run --name=mybusy busybox`。创建一个镜像名称为`busybox:latest`的容器,并命名为`mybusy`
            * `docker run busybox cal`。创建一个镜像名称为`busybox:latest`的容器并在容器中执行`cal`命令 
            * `docker run -it ubuntu /bin/bash`。创建一个镜像名称为`ubuntu:latest`的容器,并打开交互式终端进入容器
* 查看指定容器的详细信息`docker inspect CONTAINER_ID`
* 常用示例
    * 创建容器:`sudo docker run -it ubuntu:latest /bin/bash`。创建并进入,`ubuntu:latest`是镜像名称与标签。
    * 启动容器:`sudo docker start 2c39efab0a2c`。当容器停止后启动,`2c39efab0a2c`是容器ID。
    * 进入容器:`sudo docker exec -it 2c39efab0a2c /bin/bash`。当容器在后台运行时进入,`2c39efab0a2c`是容器ID。
    * 进入容器:`sudo docker attach 2c39efab0a2c`。当容器在后台运行时进入主线程,`2c39efab0a2c`是容器ID。
    * 停止容器:`sudo docker stop 2c39efab0a2c`。当容器正在运行时停止,`2c39efab0a2c`是容器ID。

## 创建容器的步骤
1. 查看网络
    ```
    docker network ls
    ```
1. 创建NAME不为bridge并且DRIVER为bridge的网络(如果需要的网络已经存在则无需创建)
    ```
    docker network create NETWORK_NAME 
    ```
    * NETWORK_NAME:网络名称 
1. docker create OPTION -it IMAGE_NAME:TAG /bin/bash "-c" "COMMAND"
    * OPTION:要配置的参数 
        * -p:端口映射,如`-p0.0.0.0:8080:80 -p0.0.0.0:6022:22`
        * --name:容器名称,如`--name=yang`
        * --hostname:容器主机名称,如`--hostname=yang`
        * --net:网络名称,如`--net=web`
        * --privileged:运行用户应有的最大权限,如`--privileged=true`
        * --gpus:使用哪些gpu,如`--gpus=all`
        * --restart:是否在docker启动后自动重启,如`--restart=always`
    * COMMAND:容器每次启动要执行的命令,建议配置为以下命令
        * 命令功能
            * 启用计划任务的`reboot`功能(在不同的系统中不同) 
                * ubuntu:`rm -rf /var/run/crond.reboot`
            * 启动计划任务服务(在不同的系统中不同)
                * ubuntu:`service cron start`
            * 启动交互式终端`/bin/bash`
        * 命令配置形式:以上的命令功能中每个命令使用`;`连接,如下
            ```
            rm -rf /var/run/crond.reboot;service cron start;/bin/bash
            ```